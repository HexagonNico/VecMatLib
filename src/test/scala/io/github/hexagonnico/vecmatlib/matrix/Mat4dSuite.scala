package io.github.hexagonnico.vecmatlib.matrix

import io.github.hexagonnico.vecmatlib.vector.Vec4d
import org.scalatest.funsuite.AnyFunSuite

class Mat4dSuite extends AnyFunSuite {

  test("Sum of matrices") {
    val a = Mat4d(
      1.0, 2.0, 3.0, 4.0,
      2.0, 3.0, 4.0, 1.0,
      3.0, 4.0, 1.0, 2.0,
      4.0, 1.0, 2.0, 3.0
    )
    val b = Mat4d(
      3.0, 4.0, 2.0, 1.0,
      4.0, 2.0, 1.0, 3.0,
      2.0, 1.0, 3.0, 4.0,
      1.0, 3.0, 4.0, 2.0
    )
    assert(a + b == Mat4d(
      4.0, 6.0, 5.0, 5.0,
      6.0, 5.0, 5.0, 4.0,
      5.0, 5.0, 4.0, 6.0,
      5.0, 4.0, 6.0, 5.0
    ))
  }

  test("Negative matrix") {
    assert(Mat4d(
      1.0, 2.0, 3.0, 4.0,
      2.0, 3.0, 4.0, 1.0,
      3.0, 4.0, 1.0, 2.0,
      4.0, 1.0, 2.0, 3.0
    ).negated == Mat4d(
      -1.0, -2.0, -3.0, -4.0,
      -2.0, -3.0, -4.0, -1.0,
      -3.0, -4.0, -1.0, -2.0,
      -4.0, -1.0, -2.0, -3.0
    ))
  }

  test("Subtraction of matrices") {
    val a = Mat4d(
      4.0, 6.0, 5.0, 5.0,
      6.0, 5.0, 5.0, 4.0,
      5.0, 5.0, 4.0, 6.0,
      5.0, 4.0, 6.0, 5.0
    )
    val b = Mat4d(
      3.0, 4.0, 2.0, 1.0,
      4.0, 2.0, 1.0, 3.0,
      2.0, 1.0, 3.0, 4.0,
      1.0, 3.0, 4.0, 2.0
    )
    assert(a - b == Mat4d(
      1.0, 2.0, 3.0, 4.0,
      2.0, 3.0, 4.0, 1.0,
      3.0, 4.0, 1.0, 2.0,
      4.0, 1.0, 2.0, 3.0
    ))
  }

  test("Matrix multiplied by a scalar") {
    assert(Mat4d(
      1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 2.0,
      1.0, 1.0, 2.0, 2.0,
      1.0, 2.0, 2.0, 3.0
    ) * 1.5 == Mat4d(
      1.5, 1.5, 1.5, 1.5,
      1.5, 1.5, 1.5, 3.0,
      1.5, 1.5, 3.0, 3.0,
      1.5, 3.0, 3.0, 4.5
    ))
  }

  test("Matrix multiplied by a scalar commutativity") {
    assert(1.5 * Mat4d(
      1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 2.0,
      1.0, 1.0, 2.0, 2.0,
      1.0, 2.0, 2.0, 3.0
    ) == Mat4d(
      1.5, 1.5, 1.5, 1.5,
      1.5, 1.5, 1.5, 3.0,
      1.5, 1.5, 3.0, 3.0,
      1.5, 3.0, 3.0, 4.5
    ))
  }

  test("Matrix-vector product") {
    val mat = Mat4d(
      0.0, 1.0, 0.0, 0.0,
      0.0, 0.0, 0.0, 1.0,
      1.0, 0.0, 0.0, 0.0,
      0.0, 0.0, 1.0, 0.0
    )
    val vec = Vec4d(2.0, 3.0, 4.0, 5.0)
    assert(mat * vec == Vec4d(3.0, 5.0, 2.0, 4.0))
  }

  test("Matrix-vector product by values") {
    val mat = Mat4d(
      0.0, 1.0, 0.0, 0.0,
      0.0, 0.0, 0.0, 1.0,
      1.0, 0.0, 0.0, 0.0,
      0.0, 0.0, 1.0, 0.0
    )
    assert(mat * (2.0, 3.0, 4.0, 5.0) == Vec4d(3.0, 5.0, 2.0, 4.0))
  }

  test("Transposed") {
    assert(Mat4d(
      0.0, 1.0, 0.0, 0.0,
      0.0, 0.0, 0.0, 1.0,
      1.0, 0.0, 0.0, 0.0,
      0.0, 0.0, 1.0, 0.0
    ).transposed == Mat4d(
      0.0, 0.0, 1.0, 0.0,
      1.0, 0.0, 0.0, 0.0,
      0.0, 0.0, 0.0, 1.0,
      0.0, 1.0, 0.0, 0.0
    ))
  }

  test("Symmetric matrix") {
    assert(Mat4d(
      0.0, 1.0, 2.0, 3.0,
      1.0, 0.0, 4.0, 5.0,
      2.0, 4.0, 0.0, 6.0,
      3.0, 5.0, 6.0, 0.0
    ).isSymmetric)
  }

  test("Skew symmetric matrix") {
    assert(Mat4d(
      0.0, 1.0, 2.0, 3.0,
      -1.0, 0.0, 4.0, 5.0,
      -2.0, -4.0, 0.0, 6.0,
      -3.0, -5.0, -6.0, 0.0
    ).isSkewSymmetric)
  }

  test("Matrix power") {
    val a = Mat4d(
      1.0, 2.0, 3.0, 4.0,
      2.0, 3.0, 4.0, 1.0,
      3.0, 4.0, 1.0, 2.0,
      4.0, 1.0, 2.0, 3.0
    )
    val b = Mat4d(
      3.0, 4.0, 2.0, 1.0,
      4.0, 2.0, 1.0, 3.0,
      2.0, 1.0, 3.0, 4.0,
      1.0, 3.0, 4.0, 2.0
    )
    assert(a * b == Mat4d(
      21.0, 23.0, 29.0, 27.0,
      27.0, 21.0, 23.0, 29.0,
      29.0, 27.0, 21.0, 23.0,
      23.0, 29.0, 27.0, 21.0
    ))
  }

  test("Test power") {
    val a = Mat4d(
      1.0, 2.0, 3.0, 4.0,
      2.0, 3.0, 4.0, 1.0,
      3.0, 4.0, 1.0, 2.0,
      4.0, 1.0, 2.0, 3.0
    )
    assert((a power 3) == (a * a * a))
  }

  test("Matrix determinant") {
    val a = Mat4d(
      2.0, 1.0, 2.0, 3.0,
      1.0, 2.0, 2.0, 2.0,
      2.0, 0.0, 0.0, 0.0,
      1.0, 2.0, 0.0, 0.0
    )
    assert(a.determinant == -8.0)
  }
}
